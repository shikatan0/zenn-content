---
title: "ã€F#, Google Driveã€‘ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œã£ã¦ã¿ãŸ"
emoji: "ğŸš¡"
type: "tech"
topics: ["fsharp", "googledrive"]
published: true
---

# æ¦‚è¦

æŒ‡å®šã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’â€…Google Driveâ€…ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹â€…F#â€…ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œã£ãŸã®ã§ç´¹ä»‹ã—ã¾ã™ã€‚

https://github.com/shikatan0/google-drive-folder-uploader

# æ©Ÿèƒ½

- æŒ‡å®šã—ãŸãƒ•ã‚©ãƒ«ãƒ€ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–ã™ã‚‹
- å‰å›ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‹ã‚‰å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿æ›´æ–°ã™ã‚‹

# ä½¿ç”¨æ–¹æ³•

1. [.NET SDK](https://dotnet.microsoft.com/download)â€…ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç§»å‹•ã—ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆâ€…`init.fsx`â€…ã‚’å®Ÿè¡Œã™ã‚‹

```powershell
dotnet fsi init.fsx
```

3. ä½œæˆã•ã‚ŒãŸâ€…`UserData.fs`â€…ã«â€…Google Drive APIâ€…ã‚’ä½¿ç”¨ã™ã‚‹ä¸Šã§å¿…è¦ãªæƒ…å ±ã‚’è¨˜å…¥ã™ã‚‹

:::message
[å–å¾—æ–¹æ³•ã®è§£èª¬](https://zenn.dev/shikatan/articles/48469d49bc957017c9fe)
:::

```fsharp:UserData.fs
[<AutoOpen>]
module UserData

let ClientId     = "ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆâ€…ID"
let ClientSecret = "èªå¯ã‚³ãƒ¼ãƒ‰"
let RefreshToken = "ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³"
```

4. ãƒ“ãƒ«ãƒ‰ã™ã‚‹

```powershell
dotnet publish -r win-x64 -p:PublishSingleFile=true --self-contained false
```

5. ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã®çµ¶å¯¾ãƒ‘ã‚¹ã‚’â€…`settings\target`â€…ã«è¨˜è¿°ã™ã‚‹

# æŒ‡å®šã—ãŸãƒ•ã‚©ãƒ«ãƒ€ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–ã™ã‚‹

ãƒ•ã‚©ãƒ«ãƒ€ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®šã¯â€…globâ€…é¢¨ã®è¨˜æ³•ã§â€…`settings\ignore`â€…ã«è¨˜è¿°ã™ã‚‹æ–¹å¼ã§ã™ã€‚
å®Ÿè£…ã¨ã—ã¦ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«è¨˜æ³•ã‹ã‚‰æ­£è¦è¡¨ç¾ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚

```fsharp
module Pattern =
    /// æ­£è¦è¡¨ç¾ã«ãŠã‘ã‚‹ç‰¹æ®Šæ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹
    let private escape (text: string) : string =
        text
            .Replace("\\", "\\\\")
            .Replace("/", "\\\\")
            .Replace(".", "\\.")

    /// ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãŠã‘ã‚‹ç‰¹æ®Šæ–‡å­—ã‚’æ­£è¦è¡¨ç¾ã«ç½®æ›ã™ã‚‹
    let private replace (text: string) : string =
        text
            .Replace("*", "[^\\\\]*?")

    /// ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¡¨ã™æ­£è¦è¡¨ç¾ã®æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹
    let private convert (text: string) : string =
        $"^.*\\\\{text}$" //ã€Œ^.*\\xx$ã€

    /// æ–‡å­—åˆ—ã‹ã‚‰æ­£è¦è¡¨ç¾ã‚’ç”Ÿæˆã™ã‚‹
    let private regex (text: string) : System.Text.RegularExpressions.Regex =
        System.Text.RegularExpressions.Regex(
            text,
            System.Text.RegularExpressions.RegexOptions.Compiled
        )

    /// ãƒ‘ã‚¿ãƒ¼ãƒ³æ–‡å­—åˆ—ã‹ã‚‰æ­£è¦è¡¨ç¾ã‚’ç”Ÿæˆã™ã‚‹
    let ToRegex = escape >> replace >> convert >> regex
```

ç‰¹æ®Šæ–‡å­—ã¯â€…0â€…æ–‡å­—ä»¥ä¸Šã®â€…`/`, `\`â€…ä»¥å¤–ã®æ–‡å­—åˆ—ã‚’è¡¨ã™â€…`*`â€…(globâ€…ã®â€…`*`â€…ã¨ç­‰ä¾¡)â€…ã®ã¿ã§ã€å…ˆé ­ã«ã¯å¸¸ã«â€…0â€…æ–‡å­—ä»¥ä¸Šã®æ–‡å­—åˆ—ãŒå…¥ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™â€…(globâ€…ã§â€…`**/`â€…ã‚’å…ˆé ­ã«è¨˜è¿°ã—ãŸå ´åˆã¨ç­‰ä¾¡)ã€‚

# æœ€å¾Œã«

ä»¥ä¸Šã€Google Driveâ€…ã«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹â€…F#â€…ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ç´¹ä»‹ã§ã—ãŸã€‚
ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº†æ™‚ã«ã‚¹ãƒªãƒ¼ãƒ—ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã§ä¸è¦ãªå ´åˆã¯ãƒ“ãƒ«ãƒ‰å‰ã«å½“è©²éƒ¨åˆ†ã‚’å‰Šé™¤ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

```fsharp
SetSuspendState(false, false, false) |> ignore
```

# é–¢é€£è¨˜äº‹

- [F# - HTTP ã§ Google Drive API ã‚’åˆ©ç”¨ã™ã‚‹](https://zenn.dev/shikatan/articles/48469d49bc957017c9fe)
- [ã€F#ã€‘Google Drive API ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](https://zenn.dev/shikatan/articles/f118cbf814d385)
- [.NET 5, F# - Google Drive API Quickstart +Î±](https://zenn.dev/shikatan/articles/6009f0f32358f55c1e76)

# end
