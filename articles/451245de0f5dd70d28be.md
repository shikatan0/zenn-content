---
title: ".NET 5, F# - Windows.Media.Ocr ã‚’ä½¿ã†"
emoji: "ğŸ“"
type: "tech"
topics: ["dotnet", "fsharp", "OCR"]
published: true
---

# Windows.Media.Ocr

[Windows.Media.Ocr [â†—]](https://docs.microsoft.com/en-us/uwp/api/windows.media.ocr) ã¯ã€ç”»åƒã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿å–ã‚‹å…‰å­¦æ–‡å­—èªè­˜ (OCR: Optical character recognition) ã‚’è¡Œã† Windows Runtime API ã§ã™[^1]ã€‚

[^1]: Windows 10 ã«ã¦æ¨™æº–æ­è¼‰ã€‚
NuGet ç‰ˆ: [Microsoft.Windows.Ocr [â†—]](https://www.nuget.org/packages/Microsoft.Windows.Ocr/)

# ç’°å¢ƒ

|å¯¾è±¡|ãƒãƒ¼ã‚¸ãƒ§ãƒ³|
|:-:|:-:|
|Windows|20H2 (19042.928)|
|.NET SDK|5.0.202|

# å®Ÿè£…ä¾‹

æŒ‡å®šã—ãŸç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿å–ã‚Šè¡¨ç¤ºã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚

```xml:.fsproj
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>net5.0-windows10.0.19041.0</TargetFramework>
    <RootNamespace>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</RootNamespace>
  </PropertyGroup>

  <ItemGroup>
    <Compile Include="Program.fs" />
  </ItemGroup>

</Project>
```

```fsharp:Program.fs
let await (iAsync: Windows.Foundation.IAsyncOperation<'TResult>) =
    System.WindowsRuntimeSystemExtensions.AsTask(iAsync).Result

let printOcrResult () =
    let ocrEngine = Windows.Media.Ocr.OcrEngine.TryCreateFromUserProfileLanguages()

    let storageFile         = await <| Windows.Storage.StorageFile.GetFileFromPathAsync(@"ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®çµ¶å¯¾ãƒ‘ã‚¹")
    let iRandomAccessStream = await <| storageFile.OpenAsync(Windows.Storage.FileAccessMode.Read)
    let bitmapDecoder       = await <| Windows.Graphics.Imaging.BitmapDecoder.CreateAsync(iRandomAccessStream)
    let softwareBitmap      = await <| bitmapDecoder.GetSoftwareBitmapAsync()
    let ocrResult           = await <| ocrEngine.RecognizeAsync(softwareBitmap)

    printfn "%s" ocrResult.Text

printOcrResult()
```

# è§£èª¬

## Windows Runtime API ã®å‚ç…§

.NET 5 ã®å ´åˆ ã¯ `.fsproj` ãƒ•ã‚¡ã‚¤ãƒ«å†…ã€`TargetFramework` ã®å€¤ã« Windows ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¤ºã™ä¸‹è¨˜ã®æ–‡å­—åˆ—ã‚’è¨­å®šã—ã¾ã™ã€‚

|ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ|å€¤|
|:-:|:-:|
|Windows 10 Version 1809|`net5.0-windows10.0.17763.0`|
|Windows 10 Version 1903|`net5.0-windows10.0.18362.0`|
|Windows 10 Version 2004|`net5.0-windows10.0.19041.0`|

:::message
[è©³ç´°ã¨ .NET 5 ä»¥å¤–ã§ã®æ–¹æ³• [â†—]](https://docs.microsoft.com/ja-jp/windows/apps/desktop/modernize/desktop-to-uwp-enhance)ã€‚
:::

## è¨€èªã®è¨­å®š

é¸æŠã§ãã‚‹è¨€èªã¯ [Windows ã®è¨€èªãƒ‘ãƒƒã‚¯ [â†—]](https://support.microsoft.com/ja-jp/windows/windows-%E7%94%A8%E3%81%AE%E8%A8%80%E8%AA%9E%E3%83%91%E3%83%83%E3%82%AF-a5094319-a92d-18de-5b53-1cfc697cfca8) ã«ä¾å­˜ã—ã¦ã„ã¾ã™ã€‚

### ä½¿ç”¨å¯èƒ½ãªè¨€èªã®ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹

```fsharp
let languages = Windows.Media.Ocr.OcrEngine.AvailableRecognizerLanguages

for l in languages do
    printfn "%s: %s" l.LanguageTag l.DisplayName
```

### ä½¿ç”¨å¯èƒ½ãªè¨€èªã‚’è‡ªå‹•ã§è¨­å®šã™ã‚‹

```fsharp
let ocrEngine = Windows.Media.Ocr.OcrEngine.TryCreateFromUserProfileLanguages()
```

### è¨€èªã‚’æ˜ç¤ºçš„ã«è¨­å®šã™ã‚‹

è¨€èªã‚¿ã‚° (BCP47) ã§æŒ‡å®šã—ã¾ã™ã€‚

```fsharp
let language  = new Windows.Globalization.Language("en")
let ocrEngine = Windows.Media.Ocr.OcrEngine.TryCreateFromLanguage(language)
```

## éåŒæœŸå‡¦ç†

Windows Runtime API ã®éåŒæœŸãƒ¡ã‚½ãƒƒãƒ‰ãŒè¿”ã™ [IAsyncOperation<TResult> [â†—]](https://docs.microsoft.com/ja-jp/uwp/api/windows.foundation.iasyncoperation-1) ã®çµæœã‚’å–å¾—ã™ã‚‹ãŸã‚ã« [Task<TResult> [â†—]](https://docs.microsoft.com/ja-jp/dotnet/api/system.threading.tasks.task-1) ã«å¤‰æ›ã—ã¾ã™[^2]ã€‚

[^2]: æ„è¨³: .NET ã§ã¯ IAsyncOperation<TResult> ã‚’ Task<TResult> ã«å¤‰æ›ã™ã‚‹ã¨ä¾¿åˆ©ã€‚
https://docs.microsoft.com/ja-jp/uwp/api/windows.foundation.iasyncoperation-1#remarks


```fsharp
let await (iAsync: Windows.Foundation.IAsyncOperation<'TResult>) =
    System.WindowsRuntimeSystemExtensions.AsTask(iAsync).Result
```

ã¾ãŸã¯

```fsharp
open System

let await (iAsync: Windows.Foundation.IAsyncOperation<'TResult>) =
    iAsync.AsTask().Result
```

# end